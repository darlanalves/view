/**
 * View
 * Author: Darlan Alves <darlan@moovia.com>
 * Built on 2013-06-23
 */
!function(a){var b=this,c={}.hasOwnProperty,d=function(){},e=b.jQuery||b.Zepto||b.ender||b.$,f=b._||b.$,g=/^attributes|styles$/,h=/^(\S+)\s*(.*)$/,i=extend({tagName:"div",className:!1,template:!1,styles:!1,attributes:!1,defaultData:!1,defaults:!1,rendered:!1,el:!1,hidden:!1,events:!1,customEvents:!1,autoRender:!1,initialize:d,render:d,beforeRender:d,afterRender:d,getEl:function(){return this.$el},getDom:function(){return this.el},getBody:function(){return this.el.innerHTML},getId:function(){return this.$id},update:function(a){return void 0!==a&&this.setData(a),this.renderView(),this},show:function(){return this.$el.show(),this},hide:function(){return this.$el.hide(),this},block:function(){return this.$el.addClass("ui-blocked"),this.undelegateEvents(),this},unblock:function(){return this.$el.removeClass("ui-blocked"),this.delegateEvents(),this},on:function(){return this.$el.on.apply(this.$el,arguments),this},off:function(){return this.$el.off.apply(this.$el,arguments),this},appendTo:function(a){return this.ensureViewIsRendered(),this.$el.appendTo(a),this},prependTo:function(a){return this.ensureViewIsRendered(),this.$el.prependTo(a),this},insertBefore:function(a){return this.ensureViewIsRendered(),a instanceof e||(a=e(a)),a.before(this.$el),this},insertAfter:function(){return this.ensureViewIsRendered(),el instanceof e||(el=e(el)),el.after(this.$el),this},select:function(){return this.$el.find.apply(this.$el,arguments)},setVisible:function(a){return a===!1?this.hide():this.show(),this},constructor:function(a){this.__initialize__!==!1&&(this.createId(),this.createView(),this.initializeView(a||{}),this.autoRender&&this.renderView())},initializeView:function(a){a=f.merge({},this.defaults||{},a),f.pick(a,function(b,c){g.test(c)&&(delete a[c],this[c]=f.merge(this[c]||{},b))},this);var b=this.defaultData||{};a.data&&(b=f.merge(b,a.data),delete a.data),this.setData(b),a.events&&(this.customEvents=a.events,delete a.events),f.extend(this,a),this.initialize(a)},createId:function(){this.$id=f.uniqueId("view")},createView:function(){var a=document.createElement(this.tagName);this.$el=e(a),this.el=a},ensureViewIsRendered:function(){this.rendered||this.renderView()},renderView:function(){this.rendered=!0,this.applyAttributes(),this.applyStyles(),this.applyClasses(),this.applyTemplate(),this.delegateEvents(),this.runProcessors("before"),this.beforeRender(),this.render(),this.runProcessors("after"),this.afterRender(),this.hidden&&this.hide()},destroyView:function(){this.undelegateEvents(),this.$el.remove(),this.el=this.$el=null},runProcessors:function(a){if(i.processors&&i.processors[a]&&i.processors[a].length){var b,c,d=i.processors[a];for(b=0,c=d.length;c>b;b++)d[b].call(this)}},applyAttributes:function(){this.attributes!==!1&&this.$el.attr(this.attributes)},applyStyles:function(){this.styles!==!1&&this.$el.css(this.styles)},applyClasses:function(){var a=[];f.each(this.getPrototypeChain("className"),function(b){b!==!1&&(f.isArray(b)&&(b=b.join(" ")),a.push(b))}),this.$el.addClass(a.join(" "))},applyTemplate:function(){var a=this.getTemplate(),b=this.getData();this.el.innerHTML=a.render(b,this.self.helpers)},getPrototypeChain:function(a){var b,d=[],e=this.self.prototype;for(c.call(this,a)&&d.push(this[a]),c.call(e,a)&&d.unshift(e[a]),b=this.superclass;b;)c.call(b,a)&&d.unshift(b[a]),b=b.superclass;return d},getTemplate:function(a){void 0===a&&(a="template");var b=this[a];return b instanceof Template||(b=new Template(b),this[a]=b),b},getData:function(){return this.data},setData:function(a){return this.data=a,this},addEvent:function(a,b,c){if("string"==typeof b){var d=this,e=b;b=function(){d[e].apply(d,arguments)}}if("function"!=typeof b)return!1;var f=a.match(h),g=f[1],i=f[2];return g+=c||"",""===i?this.$el.on(g,b):this.$el.on(g,i,b),this},delegateEvents:function(){if(this.events!==!1||this.customEvents!==!1){this.undelegateEvents();var a=".delegate"+this.getId();return this.events&&f.each(this.events,function(b,c){this.addEvent(c,b,a)},this),this.customEvents&&f.each(this.customEvents,function(b,c){this.addEvent(c,b,a)},this),this}},undelegateEvents:function(){return this.$el.off(".delegate"+this.getId()),this},statics:{helpers:{},helper:function(a,b){return this.helpers[a]=b,this},match:function(a,b){return Template.registerProcessor(a,b),this},addProcessor:function(a,b){this.processors||(this.processors={}),this.processors[a]||(this.processors[a]=[]),this.processors[a].push(b)},before:function(a){return this.addProcessor("before",a),this},after:function(a){return this.addProcessor("after",a),this}}});a.View=i}("object"==typeof exports&&exports||this);